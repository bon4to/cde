<!DOCTYPE html>
<html lang="pt-br">
    <head>
        <title>Movimentar | TRANS LÉGUA</title>


        {% include "shared/header.html" %}

            <div id="floating-container" draggable="false" class="form-container" style="position: relative">
                <div class="split-horizontal" style="align-items: end">
                    <div style="scale: 0.7">
                        <button class="pin" id="fix-move-btn" onclick="toggleFixMove()">
                            <img class="svg-gray" src="{{ url_for('static', filename='icons/window-restore.svg') }}" alt="">
                        </button>
                    </div>
                </div>
                <div class="centralizado">
                <div>
                    <div>
                        <form id="formBuscarItens" method="post" onsubmit="lockIcoShow()">
                            <label for="cod_str_qr"></label>
                            <div class="split-horizontal">
                                <input type="text" style="width: 320px;" id="cod_str_qr" maxlength="14" name="cod_str_qr" required placeholder="Leia o QR-Code ou o DUN-14...">
                                <input class="subm" style="width: 42px; height: 42px; margin-left: 4px; padding: 8px" type="image" src="{{ url_for('static', filename='icons/scan-barcode.svg') }}" alt="">
                            </div>
                            <hr>
                        </form>
                        <div id="resultadoBusca"></div>
                        <form style="display: flex;" id="field" method="post" action="/mov/moving">
                            <div>
                                <label for="produto">Produto
                                    <img id="label-desc" class="svg-label" src="{{ url_for('static', filename='icons/lock.svg') }}" alt=""><br>
                                </label>
                                <input name="produto" id="produto" type="text" value="{{ descITEM }}" required readonly placeholder="Produto...">
                            </div>
                            <div class="split-horizontal">
                                <div>
                                    <label for="codsku">SKU
                                        <img id="label-sku" class="svg-label" src="{{ url_for('static', filename='icons/lock.svg') }}" alt="">
                                    </label><br>
                                    <select class="address" id="codsku" name="codinterno" required></select>
                                </div>
                                <div>
                                    <label for="lote_item" >Lote
                                        <img id="label-lote" class="svg-label" src="{{ url_for('static', filename='icons/lock.svg') }}" alt="">
                                    </label><br>
                                    <input class="address" pattern="[A-Z0-9]{6}" maxlength="6" id="lote_item" type="text" name="lote" value="{{ codLOTE }}" required readonly placeholder="Lote...">
                                </div>
                            </div>
                            <hr>
                            <div class="split-horizontal">
                                <div>
                                    <label for="operacao">Operação</label><br>
                                    <select name="operacao" id="operacao" class="address" onchange="toggleFields()">
                                        <option value="entrada">Entrada ⭣</option>
                                        <option value="saída">Saída ⭡</option>
                                        <option value="transferencia">Transferência ⮃</option>
                                    </select>
                                </div>
                                <div>
                                    <label for="quantidade1">Quantidade</label><br>
                                    <input class="address" type="number" id="quantidade1" name="quantidade" min="1" required placeholder="Quantidade...">
                                </div>
                            </div>
                            <div class="split-horizontal">
                                <div>
                                    <label for="letra1">Endereço</label><br>
                                    <div class="endereco-container">
                                        <select class="address" id="letra1" name="letra">
                                            <option value="A">A</option>
                                            <option value="B">B</option>
                                            <option value="C">C</option>
                                            <option value="D">D</option>
                                            <option value="PROD.">PRODUÇÃO</option>
                                            <option value="SEPAR.">SEPARAÇÃO</option>
                                            <option value="P. PALETE">PORTA PALETE</option>
                                            <option value="C. FRIA">CÂMARA FRIA</option>
                                            <option value="AMOSTRA">AMOSTRA</option>
                                        </select>
                                    </div>
                                </div>
                                <div>
                                    <label for="number1"> </label><br>
                                    <input class="address" type="number" id="number1" name="numero" step="any" min="1" max="99999.9" required placeholder="Número...">
                                </div>
                            </div>
                            <div id="destinoFields" style="display: none;">
                            <div style="text-align: center;">
                                <img class="svg-orange" src="{{ url_for('static', filename='icons/arrow-down.svg') }}" alt="">
                            </div>
                                <div class="split-horizontal">
                                    <div class="endereco-container">
                                        <label for="destino_letter1">Endereço de Destino</label><br>
                                        <select class="address" id="destino_letter1" name="destino_letter">
                                            <option value="A">A</option>
                                            <option value="B">B</option>
                                            <option value="C">C</option>
                                            <option value="D">D</option>
                                            <option value="PROD.">PRODUÇÃO</option>
                                            <option value="SEPAR.">SEPARAÇÃO</option>
                                            <option value="P. PALETE">PORTA PALETE</option>
                                            <option value="C. FRIA">CÂMARA FRIA</option>
                                            <option value="AMOSTRA">AMOSTRA</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label for="destino_number1"> </label><br>
                                        <input class="address" type="number" id="destino_number1" name="destino_number" step="any" min="1" max="99999.9" placeholder="Número...">
                                    </div>

                                    </div>
                                </div>
                                <input class="subm" type="submit" value="Registrar...">
                            </form>
                        </div>
                    </div>
                </div>
            </div>
                <div class="tables-container" id="tables-cont">
                    <div class="split-horizontal">
                        <h1>Saldo Atual do Estoque</h1>
                        <div style="display: flex">
                            <img class="svg-gray" src="{{ url_for('static', filename='icons/clipboard-list.svg') }}" alt="" onclick="toggleContainer()">
                            <img class="svg-gray" src="{{ url_for('static', filename='icons/history.svg') }}" alt="" onclick="window.location.href='{{ url_for('historico') }}';">
                            <img class="svg-gray" src="{{ url_for('static', filename='icons/filter.svg') }}" alt="" onclick="toggleFilter()">
                        </div>
                    </div>
                    <div style="justify-content: flex-end" >
                        <label for="searchInput1"></label>
                        <label for="filterSelect"></label>
                        <div id="table-filter" style="display: none" >
                            <input type="text" class="searchInput" id="searchInput1" oninput="filterTable()" placeholder="Filtrar por...">
                            <select class="address" name="filterIndex" id="filterSelect" onchange="updateFilterIndex()">
                                <option value=2>Produto (Descrição)</option>
                                <option value=0>Endereço (Letra)</option>
                                <option value=1>Endereço (Número)</option>
                                <option value=3>Lote (Código)</option>
                            </select>
                        </div>
                    </div>
                    <div class="table-overflow">
                        <table class="saldoTable">
                            <tr>
                                <th>Rua</th>
                                <th>Número</th>
                                <th>Produto (Descrição)</th>
                                <th>Lote</th>
                                <th>Saldo (CX)</th>
                            </tr>
                            {% for item in saldo_atual %}
                            <tr>
                                <td>{{ item['letra'] }}</td>
                                <td>{{ item['numero'] }}</td>
                                <td>{{ item['produto'] }}</td>
                                <td>{{ item['lote'] }}</td>
                                <td>{{ item['saldo'] }}</td>
                            </tr>
                            {% endfor %}
                        </table>
                    </div>
                    <a href="{{ url_for('export_csv_tipo', tipo='saldo') }}">
                        Baixar tabela...
                    </a>
                </div>
        <script>

            $("#formBuscarItens").submit(function(event) {
                event.preventDefault();
                buscarItens();
            });

            function buscarItens() {
                var codigo = $("#cod_str_qr").val();

                $.ajax({
                    type: "POST",
                    url: "/searching",
                    data: { cod_str_qr: codigo },
                    success: function(response) {

                        $("#produto").val(response.descITEM);
                        $("#cod_str_qr").val("");
                        $("#codsku").empty();

                        if (response.codITEM.length > 1) {
                            lockIcoHide("label-sku");
                        }

                        if (response.codITEM) {
                            response.codITEM.forEach(function(item) {

                                $("#codsku").append("<option value='" + item + "'>" + item + "</option>");
                            });
                        } else {
                            $("#codsku").append("<option value=''></option>");
                        }

                        $("#lote_item").val(response.codLOTE);

                        if (response.codLOTE === "") {
                            lockIcoHide("label-lote")

                            $("#lote_item").prop("readonly", false);
                        } else {

                            $("#lote_item").prop("readonly", true);
                        }
                    },

                    error: function(error) {
                        console.error("Erro ao buscar itens:", error);
                    }
                });
            }

        </script>

    <!-- SUPLEMENTO P/ FILTRO [LB-FILTER] -->
        <script src="{{ url_for('static', filename='js/lb-filter.js') }}"></script>

    {% include 'shared/footer.html' %}